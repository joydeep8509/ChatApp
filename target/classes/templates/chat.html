<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RT - Chat App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
<div class="w-full max-w-lg bg-white shadow-lg rounded-lg p-6">
    <h1 class="text-2xl font-bold text-center mb-4">RT - Chat App</h1>

    <!-- Chat Box -->
    <div id="chat" class="border rounded-lg p-4 mb-4 h-80 overflow-y-auto bg-gray-50">
        <!-- Messages will appear here -->
    </div>

    <!-- Sender Input -->
    <div class="mb-3">
        <input id="senderInput" type="text"
               class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:border-blue-400"
               placeholder="Your name..." />
    </div>

    <!-- Message Input -->
    <div class="mb-3">
        <input id="messageInput" type="text"
               class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:border-blue-400"
               placeholder="Type a message..." />
    </div>

    <!-- Send Button -->
    <div class="text-right">
        <button id="sendMessage"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded disabled:opacity-50">
            Send
        </button>
    </div>
</div>

<script>
    var stompClient = null;

    function setConnected(connected) {
        var btn = document.getElementById('sendMessage');
        if (btn) btn.disabled = !connected;
    }

    function connect() {
        var socket = new SockJS('/chat');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log("Connected to WebSocket:", frame);
            setConnected(true);
            stompClient.subscribe('/topic/messages', function (message) {
                console.log("Received message:", message);
                showMessage(JSON.parse(message.body));
            });
        });
    }

    function showMessage(message) {
        var chat = document.getElementById('chat');
        var messageElement = document.createElement('div');

        messageElement.className = "mb-2";
        messageElement.innerHTML = `
            <div class="p-2 rounded-lg bg-blue-100">
                <span class="font-semibold text-blue-700">${message.sender}:</span>
                <span class="text-gray-700">${message.content}</span>
            </div>
        `;

        chat.appendChild(messageElement);
        chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {
        var sender = document.getElementById('senderInput').value.trim();
        var content = document.getElementById('messageInput').value.trim();
        if (!sender || !content) return;

        var chatMessage = {
            sender: sender,
            content: content
        };
        stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
        document.getElementById('messageInput').value = '';
    }

    window.onload = function () {
        connect();
        document.getElementById('sendMessage').onclick = sendMessage;
    };
</script>
</body>
</html>
